# Supabase Auth + Next.js í”„ë¡œì íŠ¸ ê·œì¹™

## í”„ë¡œì íŠ¸ ê°œìš”
- **Framework**: Next.js 16 (App Router)
- **Language**: TypeScript (strict mode)
- **Styling**: Tailwind CSS v4
- **UI Library**: shadcn/ui (new-york style, zinc base color)
- **Auth**: Supabase Auth (Google, GitHub, Email OTP, Email/Password)
- **Database**: Supabase PostgreSQL with RLS (Row Level Security)
- **Package Manager**: npm

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
  app/                    # Next.js App Router
    (auth)/              # Route group
      signin/            # ë¡œê·¸ì¸ í˜ì´ì§€
    admin/               # ê´€ë¦¬ì í˜ì´ì§€
      business-objects/  # BusinessObject ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬
      business-relations/ # BusinessObject ì¸ìŠ¤í„´ìŠ¤ ê°„ ê´€ê³„
      relationships/     # Type ê°„ ê´€ê³„ ì •ì˜
      policies/          # Policy ê´€ë¦¬
      states/            # State ê´€ë¦¬
      transitions/       # StateTransition ê´€ë¦¬
      permissions/       # Permission ê´€ë¦¬
      roles/             # Role ê´€ë¦¬
      groups/            # Group ê´€ë¦¬
      types/             # Type ê´€ë¦¬
      attributes/        # Attribute ê´€ë¦¬
    api/                 # API Routes
      auth/signout/      # ë¡œê·¸ì•„ì›ƒ (Route Handler)
      profile/ensure/    # í”„ë¡œí•„ í™•ì¸/ìƒì„±
      session/           # JWT ì¿ í‚¤ ì €ì¥
      supabase-session/  # Supabase ì„¸ì…˜ ì¿ í‚¤ ì €ì¥
      business-relations/ # BusinessObject ê´€ê³„ API
      relationships/     # Type ê´€ê³„ API
    auth/                # ì¸ì¦ ê´€ë ¨
      callback/          # OAuth ì½œë°± (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸)
      verify/            # ì´ë©”ì¼ ì¸ì¦ ì•ˆë‚´
      update-password/  # ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    dashboard/           # ë³´í˜¸ëœ í˜ì´ì§€
    profiles/            # í”„ë¡œí•„ ëª©ë¡ (ê²€ìƒ‰/í˜ì´ì§•)
    notes/               # RLS ì˜ˆì œ
  components/
    ui/                  # shadcn/ui ì»´í¬ë„ŒíŠ¸
    admin/               # Admin í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
    profiles/            # í”„ë¡œí•„ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
  lib/
    supabase/
      client.ts         # ë¸Œë¼ìš°ì € Supabase í´ë¼ì´ì–¸íŠ¸ (ì‹±ê¸€í„´)
      server.ts         # ì„œë²„ Supabase í´ë¼ì´ì–¸íŠ¸ (ì½ê¸° ì „ìš©)
    logger.ts           # ì¸ì¦ ë¡œê·¸ ìœ í‹¸
    utils.ts            # shadcn/ui utils
middleware.ts           # ì„¸ì…˜ ì¿ í‚¤ ë™ê¸°í™”
supabase/               # SQL ìŠ¤í¬ë¦½íŠ¸
  profiles.sql          # í”„ë¡œí•„ í…Œì´ë¸”/íŠ¸ë¦¬ê±°
  notes.sql             # ë…¸íŠ¸ í…Œì´ë¸”/RLS
  admin-policies.sql    # ê´€ë¦¬ì RLS ì •ì±…
  migrate-existing-profiles.sql  # ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
```

## ì¸ì¦ ë° ì„¸ì…˜ ê´€ë¦¬

### ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸ (`src/lib/supabase/client.ts`)
- ì‹±ê¸€í„´ íŒ¨í„´ ì‚¬ìš© (`getBrowserSupabase()`)
- PKCE flow (`flowType: "pkce"`)
- `detectSessionInUrl: true` (ìë™ ì„¸ì…˜ êµí™˜)
- localStorage í‚¤: `"app-auth"`

### ì„œë²„ í´ë¼ì´ì–¸íŠ¸ (`src/lib/supabase/server.ts`)
- **ì¤‘ìš”**: Next.js 15 ì œì•½ìœ¼ë¡œ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì¿ í‚¤ ì½ê¸°ë§Œ ê°€ëŠ¥
- `set()`, `remove()`ëŠ” no-op (ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì²˜ë¦¬)
- ì¿ í‚¤ ìˆ˜ì •ì´ í•„ìš”í•˜ë©´ Route Handlerì—ì„œ ë³„ë„ í´ë¼ì´ì–¸íŠ¸ ìƒì„±

### ë¯¸ë“¤ì›¨ì–´ (`middleware.ts`)
- ëª¨ë“  ìš”ì²­ì—ì„œ Supabase ì„¸ì…˜ ì¿ í‚¤ ë™ê¸°í™”
- `supabase.auth.getSession()` í˜¸ì¶œë¡œ ì¿ í‚¤ ìë™ ì—…ë°ì´íŠ¸

### ì„¸ì…˜ ì´ì¤‘ ê´€ë¦¬
1. **ë¸Œë¼ìš°ì €**: localStorageì— ì €ì¥ (PKCE code_verifier í¬í•¨)
2. **ì„œë²„**: HttpOnly ì¿ í‚¤
   - Supabase ì„¸ì…˜ ì¿ í‚¤ (ìë™ ê´€ë¦¬)
   - `app_jwt` ì¿ í‚¤ (access_token ì €ì¥, ì»¤ìŠ¤í…€ API ì¸ì¦ìš©)

### OAuth í”Œë¡œìš°
1. `/signin` â†’ `signInWithOAuth()` â†’ Provider ë¦¬ë‹¤ì´ë ‰íŠ¸
2. Provider ì¸ì¦ ì™„ë£Œ â†’ `/auth/callback?code=...`
3. ì½œë°± í˜ì´ì§€: `detectSessionInUrl=true`ë¡œ ìë™ êµí™˜
4. `/api/session`ì— access_token ì „ë‹¬ â†’ `app_jwt` ì¿ í‚¤ ì €ì¥
5. `/api/supabase-session`ì— access_token/refresh_token ì „ë‹¬ â†’ ì„œë²„ ì¿ í‚¤ ì„¤ì •
6. `/api/profile/ensure`ë¡œ í”„ë¡œí•„ í™•ì¸/ìƒì„± (signup/signin êµ¬ë¶„)
7. `/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### `public.profiles` í…Œì´ë¸”
- **Primary Key**: `id` (uuid, references `auth.users.id`)
- **ì»¬ëŸ¼**: email, full_name, name, avatar_url, provider, bio, website, gender, phone_number, created_at, updated_at
- **RLS**: ë³¸ì¸ í”„ë¡œí•„ë§Œ ì¡°íšŒ/ìˆ˜ì • ê°€ëŠ¥
- **íŠ¸ë¦¬ê±°**: `auth.users` INSERT ì‹œ ìë™ìœ¼ë¡œ `profiles`ì—ë„ INSERT

### `public.notes` í…Œì´ë¸”
- **ì»¬ëŸ¼**: id, user_id, content, created_at
- **RLS**: ë³¸ì¸ ë…¸íŠ¸ë§Œ CRUD ê°€ëŠ¥

## ì½”ë”© ê·œì¹™

### íŒŒì¼ ë„¤ì´ë°
- ì»´í¬ë„ŒíŠ¸: PascalCase (ì˜ˆ: `ProfilesList.tsx`)
- ìœ í‹¸/ë¼ì´ë¸ŒëŸ¬ë¦¬: camelCase (ì˜ˆ: `getServerSupabase()`)
- Route Handler: `route.ts`
- í˜ì´ì§€: `page.tsx`

### URL ê²½ë¡œ ë° í´ë” êµ¬ì¡° (Admin í˜ì´ì§€)

#### URL ë„¤ì´ë°
- **í˜•ì‹**: kebab-case ë³µìˆ˜í˜• ì‚¬ìš©
- **ì˜ˆì‹œ**:
  - âœ… `/admin/business-objects` (O)
  - âœ… `/admin/business-relations` (O) - BusinessObject ì¸ìŠ¤í„´ìŠ¤ ê°„ ê´€ê³„
  - âœ… `/admin/relationships` (O) - Type ê°„ ê´€ê³„ ì •ì˜
  - âœ… `/admin/permissions` (O)
  - âŒ `/admin/BusinessObject` (X)
  - âŒ `/admin/business_object` (X)
  - âŒ `/admin/business-object-relationships` (X) - ë„ˆë¬´ ê¹€

#### í´ë” ë¼ìš°íŒ… êµ¬ì¡° (Next.js App Router í‘œì¤€)
**ëª¨ë“  Admin í˜ì´ì§€ëŠ” ë‹¤ìŒ í´ë” êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤:**

```
/admin/
  {resource-name}/        # ë¦¬ì†ŒìŠ¤ í´ë” (kebab-case ë³µìˆ˜í˜•)
    page.tsx              # ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€
    [id]/                 # ë™ì  ë¼ìš°íŠ¸
      page.tsx            # ìƒì„¸/ìˆ˜ì • í˜ì´ì§€
    actions.ts            # Server Actions (optional)
```

**ì˜ˆì‹œ:**
```
/admin/business-objects/
  page.tsx              # BusinessObject ë¦¬ìŠ¤íŠ¸
  [id]/page.tsx         # BusinessObject ìƒì„¸
  actions.ts            # BusinessObject CRUD ì„œë²„ ì•¡ì…˜

/admin/business-relations/
  page.tsx              # BusinessObjectRelationship ë¦¬ìŠ¤íŠ¸
  [id]/page.tsx         # BusinessObjectRelationship ìƒì„¸/ìˆ˜ì •

/admin/relationships/
  page.tsx              # Relationship ë¦¬ìŠ¤íŠ¸
  [id]/page.tsx         # Relationship ìƒì„¸/ìˆ˜ì •

/admin/policies/
  page.tsx              # Policy ë¦¬ìŠ¤íŠ¸
  [id]/page.tsx         # Policy ìƒì„¸
  actions.ts            # Policy CRUD ì„œë²„ ì•¡ì…˜
```

**ì¼ê´€ì„± ê·œì¹™:**
- âœ… ë¦¬ìŠ¤íŠ¸: `{resource}/page.tsx`
- âœ… ìƒì„¸/ìˆ˜ì •: `{resource}/[id]/page.tsx`
- âœ… ìƒˆë¡œ ë§Œë“¤ê¸°: ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ dialog/drawer ì‚¬ìš© ë˜ëŠ” `[id]`ì—ì„œ ì²˜ë¦¬
- âœ… Server Actions: `{resource}/actions.ts` (ì„ íƒì )
- âŒ `new/page.tsx` ë³„ë„ í˜ì´ì§€ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (dialog íŒ¨í„´ ì„ í˜¸)

#### Components í´ë” êµ¬ì¡° (Admin)
**ëª¨ë“  Admin ì»´í¬ë„ŒíŠ¸ëŠ” ë¦¬ì†ŒìŠ¤ë³„ í•˜ìœ„ í´ë”ì— ë°°ì¹˜í•©ë‹ˆë‹¤:**

```
components/admin/
  {resource-name}/        # ë¦¬ì†ŒìŠ¤ í´ë” (kebab-case ë³µìˆ˜í˜•)
    {Resource}List.tsx    # ë¦¬ìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
    {Resource}Form.tsx    # í¼ ì»´í¬ë„ŒíŠ¸ (ìƒì„±/ìˆ˜ì •)
    {Resource}Dialog.tsx  # Dialog ì»´í¬ë„ŒíŠ¸ (ì„ íƒì )
    {Resource}Detail.tsx  # ìƒì„¸ ì»´í¬ë„ŒíŠ¸ (ì„ íƒì )
    Delete{Resource}Dialog.tsx  # ì‚­ì œ í™•ì¸ Dialog (ì„ íƒì )
```

**ì˜ˆì‹œ:**
```
components/admin/
  business-relations/
    BusinessObjectRelationshipList.tsx
    BusinessObjectRelationshipForm.tsx
  relationships/
    RelationshipList.tsx
    RelationshipForm.tsx
  policies/
    PolicyList.tsx
    PolicyDialog.tsx
    PolicyDetail.tsx
    DeletePolicyDialog.tsx
  types/
    TypeList.tsx
    TypeDialog.tsx
    TypeDetail.tsx
    DeleteTypeDialog.tsx
```

**ì¼ê´€ì„±:**
- âœ… í´ë”ëª…: kebab-case ë³µìˆ˜í˜• (`business-relations/`, `relationships/`)
- âœ… ì»´í¬ë„ŒíŠ¸ëª…: PascalCase (`BusinessObjectRelationshipList.tsx`)
- âœ… Import: `@/components/admin/{resource}/{Component}`

### Import ê²½ë¡œ
- ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©: `@/components/ui/button`
- `tsconfig.json`ì˜ `paths` ì„¤ì • í™œìš©

### ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
- UI ì»´í¬ë„ŒíŠ¸ëŠ” `src/components/` ë””ë ‰í† ë¦¬
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸ëŠ” ë¶„ë¦¬
- shadcn/ui ì»´í¬ë„ŒíŠ¸ëŠ” `src/components/ui/`

### ì„œë²„/í´ë¼ì´ì–¸íŠ¸ êµ¬ë¶„
- ì„œë²„ ì»´í¬ë„ŒíŠ¸ ê¸°ë³¸ (async ê°€ëŠ¥)
- `"use client"`ëŠ” ìƒíƒœ/ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•„ìš” ì‹œë§Œ
- ì„œë²„ ì•¡ì…˜: `"use server"` ì§€ì‹œì–´ ì‚¬ìš©

### ì—ëŸ¬ ì²˜ë¦¬
- try-catch ì‚¬ìš©
- `logAuth()`ë¡œ ì¸ì¦ ê´€ë ¨ ë¡œê·¸ ê¸°ë¡
- ì‚¬ìš©ìì—ê²ŒëŠ” ê°„ë‹¨í•œ ë©”ì‹œì§€, ë¡œê·¸ì—ëŠ” ìƒì„¸ ì •ë³´

### íƒ€ì… ì•ˆì „ì„±
- `unknown` íƒ€ì… ì‚¬ìš© í›„ íƒ€ì… ê°€ë“œë¡œ ê²€ì¦
- `err instanceof Error`ë¡œ ì—ëŸ¬ íƒ€ì… í™•ì¸
- Supabase íƒ€ì… í™œìš©

### ì¿ í‚¤ ì œì•½ ì‚¬í•­
- **ì„œë²„ ì»´í¬ë„ŒíŠ¸**: ì½ê¸° ì „ìš© (`cookies().get()`)
- **Route Handler**: ì½ê¸°/ì“°ê¸° ê°€ëŠ¥ (`NextResponse.cookies.set()`)
- **Server Action**: ì½ê¸° ì „ìš© ë˜ëŠ” Route Handler í˜¸ì¶œ

### ê²€ìƒ‰ ë° í˜ì´ì§•
- Supabaseì˜ `.or()` ë° `.ilike()` ì‚¬ìš©
- `.range(offset, offset + pageSize - 1)`ë¡œ í˜ì´ì§•
- `count: "exact"`ë¡œ ì´ ê°œìˆ˜ ì¡°íšŒ

## í™˜ê²½ ë³€ìˆ˜

```bash
NEXT_PUBLIC_SUPABASE_URL="https://YOUR-PROJECT-REF.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="YOUR-ANON-KEY"
NEXT_PUBLIC_SITE_URL="http://localhost:3000"  # ê°œë°œ: localhost, ë°°í¬: ì‹¤ì œ ë„ë©”ì¸
```

## ì¸ì¦ ë¡œê·¸

- `logAuth()` í•¨ìˆ˜ë¡œ ì¸ì¦ í”Œë¡œìš° ë¡œê¹…
- ê°œë°œ í™˜ê²½ì—ì„œëŠ” í•­ìƒ í™œì„±í™”
- í”„ë¡œë•ì…˜ì—ì„œëŠ” `NEXT_PUBLIC_DEBUG_AUTH=1` ë˜ëŠ” `DEBUG_AUTH=1`ë¡œ ì œì–´

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **RLS ì •ì±…**: ëª¨ë“  í…Œì´ë¸”ì— Row Level Security í™œì„±í™”
2. **JWT ì¿ í‚¤**: HttpOnly, Secure (í”„ë¡œë•ì…˜), SameSite=lax
3. **ì„¸ì…˜ ê´€ë¦¬**: ë¯¸ë“¤ì›¨ì–´ì—ì„œ ìë™ ë™ê¸°í™”
4. **ì¿ í‚¤ ìˆ˜ì •**: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ë¶ˆê°€, Route Handlerì—ì„œë§Œ ê°€ëŠ¥

## ì¼ë°˜ ê·œì¹™

1. **í•œêµ­ì–´ ì£¼ì„/ë©”ì‹œì§€**: ì‚¬ìš©ì ëŒ€ìƒ í…ìŠ¤íŠ¸ëŠ” í•œêµ­ì–´
2. **ì½”ë“œ ì£¼ì„**: ë³µì¡í•œ ë¡œì§ì—ë§Œ ê°„ë‹¨íˆ
3. **ì—ëŸ¬ ë©”ì‹œì§€**: ì‚¬ìš©ì ì¹œí™”ì , ë¡œê·¸ì—ëŠ” ìƒì„¸ ì •ë³´
4. **ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬**: ì¬ì‚¬ìš©ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± ê³ ë ¤
5. **íƒ€ì… ì•ˆì „ì„±**: TypeScript strict mode ì¤€ìˆ˜
6. **ì¼ê´€ì„±**: ê¸°ì¡´ íŒ¨í„´ê³¼ ìŠ¤íƒ€ì¼ ìœ ì§€
7. **Description í•„ë“œ**: ëª¨ë“  ì£¼ìš” ì—”í‹°í‹°ì— `description` í•„ë“œ í¬í•¨ (Policy, State, Role, Group, Type, Attribute, Type, BusinessObject)

## API ì—”ë“œí¬ì¸íŠ¸

- `POST /api/session`: access_tokenì„ `app_jwt` ì¿ í‚¤ë¡œ ì €ì¥
- `POST /api/supabase-session`: access_token/refresh_tokenìœ¼ë¡œ ì„œë²„ ì¿ í‚¤ ì„¤ì •
- `POST /api/profile/ensure`: í”„ë¡œí•„ í™•ì¸/ìƒì„± (íŠ¸ë¦¬ê±° ì‹¤íŒ¨ ì‹œ ë°±ì—…)
- `POST /api/auth/signout`: ë¡œê·¸ì•„ì›ƒ (Route Handler)

## SQL ì‹¤í–‰ ìˆœì„œ

1. `supabase/profiles.sql`: í…Œì´ë¸” ìƒì„±, RLS ì •ì±…, íŠ¸ë¦¬ê±°
2. `supabase/migrate-existing-profiles.sql`: ê¸°ì¡´ ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„± (í•„ìš” ì‹œ)
3. `supabase/notes.sql`: ë…¸íŠ¸ í…Œì´ë¸” ë° RLS (ì˜ˆì œ)
4. `supabase/admin-policies.sql`: ê´€ë¦¬ì RLS ì •ì±… (ì„ íƒ)

## Policy ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ

### ë°ì´í„° ëª¨ë¸ (Prisma)

- **ORM**: Prisma Client
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (Supabase)
- **ì£¼ìš” í…Œì´ë¸”**:
  - `Policy`: ê¶Œí•œ ì •ì±… (`types: string[]`)
  - `State`: Policy ë‚´ ìƒíƒœ (ë‹¤ì¤‘ next state ì§€ì›)
  - `StateTransition`: State ê°„ ì „ì´ ê´€ê³„
  - `Permission`: Stateë³„ ê¶Œí•œ (User/Role/Group Ã— create/view/modify/delete)
  - `Role`, `Group`: ì—­í•  ë° ê·¸ë£¹ ì •ì˜
  - `UserRole`, `UserGroup`: Userì™€ì˜ Many-to-Many ê´€ê³„

### State ì „ì´ ê´€ë¦¬

- `StateTransition` í…Œì´ë¸”ë¡œ ë‹¤ì¤‘ next state ì§€ì›
- `condition` í•„ë“œë¡œ ì „ì´ ì¡°ê±´ (expression) ì €ì¥
- `order` í•„ë“œë¡œ State ìˆœì„œ ê´€ë¦¬ (State Diagram í‘œì‹œìš©)

### ê¶Œí•œ í‰ê°€

- **ì§ì ‘ ê¶Œí•œ**: `UserPermission` (Userë³„)
- **Role ê¶Œí•œ**: `Permission` (targetType='role')
- **Group ê¶Œí•œ**: `Permission` (targetType='group')
- **Expression í‰ê°€**: `expression` í•„ë“œ í‰ê°€ ê²°ê³¼ê°€ `true`ì¼ ë•Œë§Œ ì ìš©
- í‰ê°€ê¸°: `src/lib/policy/evaluator.ts`ì˜ `evaluateExpression()`
- **ë©€í‹° Action**: `action` í•„ë“œëŠ” ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ì—¬ëŸ¬ action í¬í•¨ ê°€ëŠ¥ (ì˜ˆ: "create,modify,delete")
  - `checkActionMatch()` í•¨ìˆ˜ë¡œ ìš”ì²­ëœ actionì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

### UI ê´€ë¦¬

- **ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨**: State ê°„ ì „ì´ ê´€ê³„ ì‹œê°í™”
- **ê¶Œí•œ í…Œì´ë¸”**: Resource Ã— Action Ã— Target (User/Role/Group) ì¡°í•© ê´€ë¦¬
- ê° í–‰ë³„ë¡œ Role, Group, User ê¶Œí•œ ì¶”ê°€ ê°€ëŠ¥
- Expression í¸ì§‘ê¸°ë¡œ ì¡°ê±´ ì…ë ¥
- **Action ë©€í‹° ì„ íƒ**: Permission ìƒì„±/ìˆ˜ì • ì‹œ Checkboxë¡œ ì—¬ëŸ¬ action ì„ íƒ ê°€ëŠ¥
  - ì €ì¥ ì‹œ ì‰¼í‘œë¡œ joiní•˜ì—¬ ì €ì¥
  - ì¡°íšŒ ì‹œ splití•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ Badgeë¡œ í‘œì‹œ

### í•„í„°ë§ ë° í˜ì´ì§• (ëª¨ë“  Admin List í˜ì´ì§€)

- **í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§**: ëª¨ë“  ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§
- **í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§•**: í•„í„°ë§ëœ ë°ì´í„° ê¸°ì¤€ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜ì´ì§• ì²˜ë¦¬
  - `useClientPagination` í›… ì‚¬ìš©
  - `ClientPagination` ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- **í˜ì´ì§€ í¬ê¸° ì„ íƒ**: 10, 20, 50, 100, ì „ì²´ ì¤‘ ì„ íƒ ê°€ëŠ¥
- **í•„í„° ë²„íŠ¼**: 
  - ğŸ” Search ì•„ì´ì½˜: í•„í„° ì ìš© í‘œì‹œìš© (í•„í„°ê°€ ìˆì„ ë•Œë§Œ í™œì„±í™”)
  - âœ• XCircle ì•„ì´ì½˜: í•„í„° ì´ˆê¸°í™” (í•„í„°ê°€ ìˆì„ ë•Œë§Œ í™œì„±í™”)
- **í•„í„° ë°°ì¹˜**: íƒ€ì´í‹€ ì¹´ë“œ ë‚´ë¶€, íƒ€ì´í‹€ í–‰ ì•„ë˜ì— ì™¼ìª½ë¶€í„° ë°°ì¹˜
- **ì¹´ìš´í„° í‘œì‹œ**: "ì´ Xê°œ / Yê°œ" í˜•ì‹ìœ¼ë¡œ í•„í„°ë§ëœ ê°œìˆ˜ í‘œì‹œ
- í•„í„° ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì²« í˜ì´ì§€ë¡œ ì´ë™
- **ì¼ê´€ì„±**: ëª¨ë“  ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ëŠ” ë™ì¼í•œ í•„í„°/í˜ì´ì§• íŒ¨í„´ ì‚¬ìš©

### íŒŒì¼ ìœ„ì¹˜

- `prisma/schema.prisma`: Prisma ìŠ¤í‚¤ë§ˆ ì •ì˜
- `src/lib/policy/types.ts`: TypeScript íƒ€ì… ì •ì˜
- `src/lib/policy/evaluator.ts`: Expression í‰ê°€ê¸°
- `src/lib/business-type-utils.ts`: Type ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ì†ì„± ìƒì†)
- `src/lib/prisma/middleware.ts`: ë¦¬ë¹„ì „ ìë™ í• ë‹¹ ë¯¸ë“¤ì›¨ì–´

### Expression í‰ê°€ ë³´ì•ˆ

- í˜„ì¬ëŠ” `new Function()` ì‚¬ìš© (ê°œë°œìš©)
- í”„ë¡œë•ì…˜ì—ì„œëŠ” Sandbox í™˜ê²½ ë˜ëŠ” AST íŒŒì„œ ì‚¬ìš© ê¶Œì¥
- ì‚¬ìš©ì ì…ë ¥ expressionì€ ë°˜ë“œì‹œ ê²€ì¦ í•„ìš”

## í…Œì´ë¸” UI êµ¬í˜„ íŒ¨í„´

### ê¸°ë³¸ êµ¬ì¡°

**ëª¨ë“  ê´€ë¦¬ í˜ì´ì§€ì˜ í…Œì´ë¸”ì€ ë‹¤ìŒ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤:**

#### 1. í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (`page.tsx`)

```tsx
const DEFAULT_PAGE_SIZE = 20

type Props = {
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>
}

export default async function SomePage({ searchParams }: Props) {
  const params = await searchParams
  const page = typeof params.page === 'string' ? parseInt(params.page, 10) : 1
  const pageSizeParam = typeof params.pageSize === 'string' ? params.pageSize : String(DEFAULT_PAGE_SIZE)
  const pageSize = pageSizeParam === 'all' ? 999999 : parseInt(pageSizeParam, 10)
  
  const { data, total } = await getData(page, pageSize)
  const totalPages = Math.ceil(total / pageSize)

  return (
    <div className="admin-page-container">
      <div className="admin-list-wrapper">
        <Suspense fallback={<div>ë¡œë”© ì¤‘...</div>}>
          <SomeList initialData={data} />
        </Suspense>
      </div>

      <div className="admin-table-spacing">
        <Pagination
          currentPage={page}
          totalPages={totalPages}
          totalCount={total}
          pageSize={pageSize}
          baseUrl="/admin/some"
        />
      </div>
    </div>
  )
}
```

#### 2. List ì»´í¬ë„ŒíŠ¸ (`List.tsx`)

```tsx
'use client'

import { Card, CardContent } from '@/components/ui/card'
import { ScrollableTable } from '@/components/ui/scrollable-table'

export function SomeList({ initialData }: { initialData: Data[] }) {
  return (
    <div className="flex flex-col h-full mt-2.5">
      {/* í—¤ë” ì¹´ë“œ: íƒ€ì´í‹€ + ì„¤ëª… + ë²„íŠ¼ (í•„í„° í¬í•¨ ê°€ëŠ¥) */}
      <div className="admin-header-wrapper">
        <Card>
          {/* í•„í„°ê°€ ì—†ëŠ” ê²½ìš° */}
          <CardContent className="admin-header-card-content">
            <h1 className="text-lg font-bold tracking-tight">ì œëª©</h1>
            <p className="text-sm text-muted-foreground">ì„¤ëª…</p>
            <div className="flex-1" />
            <Button onClick={handleCreate}>
              <PlusCircle className="mr-2 h-4 w-4" />
              ìƒˆ í•­ëª© ìƒì„±
            </Button>
          </CardContent>

          {/* í•„í„°ê°€ ìˆëŠ” ê²½ìš° (Permission, Transition ë“±) */}
          <CardContent className="admin-header-card-content flex-col items-start">
            {/* íƒ€ì´í‹€ í–‰ */}
            <div className="flex items-center w-full gap-2">
              <h1 className="text-lg font-bold tracking-tight">ì œëª©</h1>
              <p className="text-sm text-muted-foreground">ì„¤ëª…</p>
              <div className="flex-1" />
              <Button onClick={handleCreate}>
                <PlusCircle className="mr-2 h-4 w-4" />
                ìƒˆ í•­ëª© ìƒì„±
              </Button>
            </div>
            
            {/* í•„í„° í–‰ */}
            <div className="flex gap-2 items-center w-full mt-2">
              <Input placeholder="ê²€ìƒ‰..." />
            </div>
          </CardContent>
        </Card>
      </div>

      <ScrollableTable>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>ì»¬ëŸ¼1</TableHead>
              <TableHead className="w-20">ì»¬ëŸ¼2</TableHead>
              {/* ... */}
            </TableRow>
          </TableHeader>
          <TableBody>
            {initialData.map((item) => (
              <TableRow key={item.id}>
                <TableCell>{item.name}</TableCell>
                {/* ... */}
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </ScrollableTable>
    </div>
  )
}
```

#### 3. CSS ìŠ¤íƒ€ì¼ (`globals.css`)

```css
@layer components {
  /* í…Œì´ë¸” í–‰ ë†’ì´ */
  table tbody tr {
    @apply h-12;  /* 48px */
  }
  
  table thead tr {
    @apply h-12;
  }
  
  table tbody td,
  table thead th {
    @apply py-2 px-4;
  }
  
  /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ */
  .scrollable-table-container {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    border: 1px solid hsl(var(--border));
    border-radius: 0.5rem;
    overflow: hidden;
  }
  
  /* í—¤ë” ì˜ì—­ (ê³ ì •, ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€) */
  .table-header-wrapper {
    flex-shrink: 0;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: none;  /* Firefox */
    -ms-overflow-style: none;  /* IE/Edge */
    padding-right: 10px;  /* ë°”ë”” ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ íŒ¨ë”© ì¶”ê°€ */
  }
  
  .table-header-wrapper::-webkit-scrollbar {
    display: none;  /* Chrome/Safari/Opera */
  }
  
  .table-header-wrapper table {
    width: fit-content;
    min-width: 100%;
    table-layout: auto;
  }
  
  /* ë°”ë”” ì˜ì—­ (ê°€ë¡œ/ì„¸ë¡œ ìŠ¤í¬ë¡¤) */
  .scrollable-table-wrapper {
    overflow-x: auto;
    overflow-y: auto;
    flex: 1;
  }
  
  .scrollable-table-wrapper table {
    width: fit-content;
    min-width: 100%;
    table-layout: auto;
  }
  
  /* ë°”ë”” í…Œì´ë¸”ì˜ í—¤ë” ìˆ¨ê¹€ */
  .scrollable-table-wrapper thead {
    visibility: hidden;
    height: 0;
  }
  
  /* í…ìŠ¤íŠ¸ ì˜¤ë²„í”Œë¡œìš° ì²˜ë¦¬ */
  .scrollable-table-container-single td,
  .scrollable-table-container-single th {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
  }
  
  /* ì…€ ë‚´ë¶€ì˜ ëª¨ë“  ìš”ì†Œë„ ellipsis ì ìš© */
  .scrollable-table-container-single td > *,
  .scrollable-table-container-single th > * {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
    max-width: 100%;
  }
  
  /* flex ì»¨í…Œì´ë„ˆëŠ” ì˜ˆì™¸ (ë²„íŠ¼ ê·¸ë£¹ ë“±) */
  .scrollable-table-container-single td > .flex,
  .scrollable-table-container-single th > .flex {
    display: flex;
  }
  
  /* code, span ë“± ì¸ë¼ì¸ ìš”ì†Œë„ ellipsis */
  .scrollable-table-container-single td code,
  .scrollable-table-container-single td span:not(.flex *),
  .scrollable-table-container-single th code,
  .scrollable-table-container-single th span:not(.flex *) {
    display: inline-block;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: bottom;
  }
  
  /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
  .scrollable-table-wrapper::-webkit-scrollbar {
    width: 10px;
    height: 10px;  /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ë†’ì´ */
  }
  
  .scrollable-table-wrapper::-webkit-scrollbar-track {
    background: hsl(var(--muted) / 0.3);
  }
  
  .scrollable-table-wrapper::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground) / 0.3);
    border-radius: 5px;
  }
  
  .scrollable-table-wrapper::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground) / 0.5);
  }
  
  /* ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ */
  .column-resizer {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 5px;
    cursor: col-resize;
    user-select: none;
    background: transparent;
    z-index: 1;
  }
  
  .column-resizer:hover {
    background: hsl(var(--primary) / 0.5);
  }
  
  .column-resizer.resizing {
    background: hsl(var(--primary));
  }
  
  .resizable-header {
    position: relative;
  }
}
```

### í…Œì´ë¸” êµ¬í˜„ ê·œì¹™

1. **ë‹¨ì¼ í…Œì´ë¸” + Sticky í—¤ë”**: í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ êµ¬ì„±
   - í—¤ë”ëŠ” `position: sticky`ë¡œ ê³ ì •
   - ë°”ë””ë§Œ ìŠ¤í¬ë¡¤
   - í—¤ë”ì™€ ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ë™ì¼í•œ ì»¬ëŸ¼ ë„ˆë¹„ ì‚¬ìš©

2. **ì»¬ëŸ¼ ì •ë ¬**: 
   - `table-layout: auto` ì‚¬ìš© (ìë™ ë„ˆë¹„ ì¡°ì •)
   - ì»¬ëŸ¼ ë„ˆë¹„ (`w-20`, `w-32` ë“±)ëŠ” ì´ˆê¸° ë„ˆë¹„ íŒíŠ¸
   - ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ë„ˆë¹„ ì ìš©

3. **í…ìŠ¤íŠ¸ ì˜¤ë²„í”Œë¡œìš° ì²˜ë¦¬**:
   - `text-overflow: ellipsis` ë¡œ ê¸´ í…ìŠ¤íŠ¸ ë§ì¤„ì„í‘œ ì²˜ë¦¬
   - í˜¸ë²„ ì‹œ ë„¤ì´í‹°ë¸Œ ë¸Œë¼ìš°ì € íˆ´íŒ (title ì†ì„±) í‘œì‹œ
   - ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì ˆ ì‹œ ë™ì ìœ¼ë¡œ í‘œì‹œ ë²”ìœ„ ë³€ê²½
   - ì…€ ë†’ì´ëŠ” í˜¸ë²„ ì‹œì—ë„ ë³€ê²½ë˜ì§€ ì•ŠìŒ

4. **ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ**:
   - ê° í—¤ë” ì…€ ì˜¤ë¥¸ìª½ ëì— ë¦¬ì‚¬ì´ì € í•¸ë“¤ ìë™ ìƒì„±
   - ë“œë˜ê·¸ë¡œ ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì ˆ ê°€ëŠ¥
   - í—¤ë”ì™€ ë°”ë”” ì…€ ë„ˆë¹„ ë™ì‹œ ì ìš©
   - ìµœì†Œ ë„ˆë¹„: 50px

5. **í˜ì´ì§•**:
   - ê¸°ë³¸ í˜ì´ì§€ í¬ê¸°: 20ê°œ
   - ì„ íƒ ê°€ëŠ¥: 10, 20, 50, 100, ì „ì²´
   - URL íŒŒë¼ë¯¸í„°: `?page=2&pageSize=50`

6. **ë†’ì´ ê³„ì‚°**:
   - í˜ì´ì§€: `h-[calc(100vh-6rem)]`
   - ì œëª© ê°„ê²©: `mb-3`
   - ë²„íŠ¼ ê°„ê²©: `mb-2`
   - í˜ì´ì§• ê°„ê²©: `mt-1 mb-1`

7. **Table ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •**:
   - `src/components/ui/table.tsx`ì˜ `overflow-auto` ë˜í¼ ì œê±°ë¨
   - ìŠ¤í¬ë¡¤ì€ ì™¸ë¶€ ì»¨í…Œì´ë„ˆì—ì„œ ì²˜ë¦¬

### ì£¼ì˜ì‚¬í•­

- âš ï¸ ë‹¨ì¼ í…Œì´ë¸” êµ¬ì¡°ì´ë¯€ë¡œ í—¤ë”ì™€ ë°ì´í„° ì»¬ëŸ¼ ë„ˆë¹„ê°€ ìë™ìœ¼ë¡œ ì¼ì¹˜
- âš ï¸ ê¸´ í…ìŠ¤íŠ¸ëŠ” ìë™ìœ¼ë¡œ ë§ì¤„ì„í‘œ ì²˜ë¦¬ë˜ë©°, í˜¸ë²„ ì‹œ ì „ì²´ í‘œì‹œë¨
- âš ï¸ ê° ì»¬ëŸ¼ ì˜¤ë¥¸ìª½ ëì„ ë“œë˜ê·¸í•˜ì—¬ ë„ˆë¹„ ì¡°ì ˆ ê°€ëŠ¥
- âš ï¸ í—¤ë”ëŠ” stickyë¡œ ê³ ì •, ìŠ¤í¬ë¡¤ ì‹œì—ë„ í•­ìƒ ë³´ì„

### ScrollableTable ì»´í¬ë„ŒíŠ¸

**ìœ„ì¹˜**: `src/components/ui/scrollable-table.tsx`

**ê¸°ëŠ¥**:
- í—¤ë”ì™€ ë°”ë””ì˜ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë™ê¸°í™”
- ê¸´ í…ìŠ¤íŠ¸ ë§ì¤„ì„í‘œ ì²˜ë¦¬ (hover ì‹œ ì „ì²´ í‘œì‹œ)
- ì»¬ëŸ¼ í¬ê¸° ì¡°ì ˆ (ë“œë˜ê·¸ ë¦¬ì‚¬ì´ì¦ˆ)
  - ê° í—¤ë” ì…€ ì˜¤ë¥¸ìª½ ëì— ë¦¬ì‚¬ì´ì € í•¸ë“¤ ìë™ ìƒì„±
  - ë“œë˜ê·¸ë¡œ ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì ˆ ê°€ëŠ¥
  - í—¤ë”ì™€ ë°”ë”” ëª¨ë‘ ë™ê¸°í™”

**ì‚¬ìš©ë²•**:
```tsx
import { ScrollableTable } from '@/components/ui/scrollable-table'

<ScrollableTable>
  <Table>
    <TableHeader>
      <TableRow>
        <TableHead>ì»¬ëŸ¼1</TableHead>
        <TableHead className="w-32">ì»¬ëŸ¼2</TableHead>
        {/* ... */}
      </TableRow>
    </TableHeader>
    <TableBody>
      {/* ë°ì´í„° í–‰ */}
    </TableBody>
  </Table>
</ScrollableTable>
```

**ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥**:
- í—¤ë” ì…€ ì˜¤ë¥¸ìª½ ê²½ê³„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ë¦¬ì‚¬ì´ì € í•¸ë“¤ í‘œì‹œ
- ë“œë˜ê·¸í•˜ì—¬ ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì ˆ
- ìµœì†Œ ë„ˆë¹„: 50px
- í—¤ë”ì™€ ë°”ë”” ì…€ ë„ˆë¹„ ìë™ ë™ê¸°í™”

## ë°˜ì‘í˜• ë””ìì¸

### AdminLayout (ì‚¬ì´ë“œë°”)

**ë¸Œë ˆì´í¬í¬ì¸íŠ¸**: 1024px (lg)

#### Desktop (â‰¥ 1024px)
- ì‚¬ì´ë“œë°”: ê³ ì • (`relative`)
- ë„ˆë¹„: 256px (ì—´ë¦¼) / 64px (ì ‘í˜)
- í† ê¸€: X / Menu ì•„ì´ì½˜

#### Mobile (< 1024px)
- ì‚¬ì´ë“œë°”: ìë™ ìˆ¨ê¹€ (`fixed`, `-translate-x-full`)
- ë„ˆë¹„: 256px (í•­ìƒ)
- ì˜¤ë²„ë ˆì´: ì—´ë ¸ì„ ë•Œ ë°˜íˆ¬ëª… ë°°ê²½
- í–„ë²„ê±° ë©”ë‰´: í™”ë©´ ì™¼ìª½ ìƒë‹¨ í”Œë¡œíŒ… ë²„íŠ¼
- ë©”ë‰´ í´ë¦­ ì‹œ: ìë™ìœ¼ë¡œ ì‚¬ì´ë“œë°” ë‹«í˜

**í™”ë©´ í¬ê¸° ê°ì§€**:
```tsx
useEffect(() => {
  const checkScreenSize = () => {
    const mobile = window.innerWidth < 1024
    if (mobile) setSidebarOpen(false)
  }
  window.addEventListener('resize', checkScreenSize)
}, [])
```

**í—¤ë” UI**:
- AdminLayoutì— ìƒë‹¨ í—¤ë” ë°” ì¶”ê°€ (h-16)
- ë‹¤í¬ëª¨ë“œ í† ê¸€ (Moon/Sun ì•„ì´ì½˜)
- í”„ë¡œí•„ ë©”ë‰´ (User ì•„ì´ì½˜ + ë“œë¡­ë‹¤ìš´)
- ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ í¬í•¨
- âš ï¸ **í˜ì´ì§€ íƒ€ì´í‹€ ì œê±°**: ìµœìƒë‹¨ í—¤ë”ì˜ í˜ì´ì§€ ì œëª© ì œê±°ë¨ (ê° í˜ì´ì§€ì˜ Card í—¤ë”ì— í‘œì‹œ)

**í˜ì´ì§€ ë†’ì´ ê³„ì‚°**:
- AdminLayout ìµœìƒë‹¨: `admin-layout-container` í´ë˜ìŠ¤ + ë™ì  ë†’ì´ ê³„ì‚°
- JavaScriptë¡œ `window.innerHeight` ê³„ì‚°í•˜ì—¬ ì ìš©
- ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìë™ìœ¼ë¡œ ì¬ê³„ì‚°
- html, body: `height: 100%` (globals.css)
- AdminLayoutì˜ main content: `flex-1 flex flex-col overflow-hidden`

**ì—¬ë°± ìµœì†Œí™”**:
- í—¤ë” ì¹´ë“œ: `py-1 px-3` (ìµœì†Œ íŒ¨ë”©)
- ì¹´ë“œ ê°„ê²©: `mb-1` (ìµœì†Œ ì—¬ë°±)
- List ì»´í¬ë„ŒíŠ¸ ìƒë‹¨: `mt-2.5` (10px, ì¹´ë“œ ìƒë‹¨ ì—¬ë°±)
- í•„í„° ì˜ì—­: `mb-0.5` (ìµœì†Œ ì—¬ë°±)
- í˜ì´ì§• ìƒë‹¨: `mt-2.5 mb-0` (10px, í…Œì´ë¸”ê³¼ í˜ì´ì§• ê°„ê²©)
- í˜ì´ì§€ í•˜ë‹¨: `pb-5` (20px)

**ì¬ì‚¬ìš© ê°€ëŠ¥í•œ CSS í´ë˜ìŠ¤** (`globals.css`):
```css
@layer components {
  /* Admin ë ˆì´ì•„ì›ƒ ìµœìƒë‹¨ ì»¨í…Œì´ë„ˆ */
  .admin-layout-container {
    display: flex;
    height: 100vh;             /* í™”ë©´ ì „ì²´ ë†’ì´ */
    overflow: hidden;
    background: hsl(var(--background));
  }
  
  /* Admin ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ê³µí†µ ë ˆì´ì•„ì›ƒ */
  .admin-page-container {
    display: flex;
    flex-direction: column;
    height: 100%;              /* ë¶€ëª¨(main - Top Header)ì˜ 100% */
    padding-left: 1.5rem;      /* 24px */
    padding-right: 1.5rem;     /* 24px */
    padding-bottom: 1.25rem;   /* 20px */
  }
  
  .admin-list-wrapper {
    flex: 1;                   /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì‚¬ìš© */
    min-height: 0;             /* flex ìì‹ì˜ ë†’ì´ ì œí•œ */
    display: flex;
    flex-direction: column;
    margin-top: 0.625rem;      /* 10px */
  }
  
  .admin-header-wrapper {
    flex-shrink: 0;
    margin-bottom: 0.25rem;    /* 4px */
  }
  
  .admin-header-card-content {
    display: flex;
    align-items: center;
    gap: 0.5rem;               /* 8px */
    padding-top: 0.25rem;      /* 4px */
    padding-bottom: 0.25rem;   /* 4px */
    padding-left: 0.75rem;     /* 12px */
    padding-right: 0.75rem;    /* 12px */
  }
  
  .admin-filter-wrapper {
    flex-shrink: 0;
    margin-bottom: 0.125rem;   /* 2px (ì¹´ë“œ ì™¸ë¶€ ì‚¬ìš© ì‹œ) */
    display: flex;
    gap: 0.5rem;               /* 8px */
    align-items: center;
    /* ì¹´ë“œ ë‚´ë¶€ ì‚¬ìš© ì‹œ: mt-2ë¡œ íƒ€ì´í‹€ í–‰ê³¼ ê°„ê²© ì¡°ì • */
  }
  
  .admin-table-spacing {
    flex-shrink: 0;
    margin-top: 0.625rem;      /* 10px */
    margin-bottom: 0;
  }
}
```

**ì‚¬ìš© ì˜ˆì‹œ**:
- í˜ì´ì§€: `<div className="admin-page-container">`
- List wrapper: `<div className="admin-list-wrapper">`
- í—¤ë” wrapper: `<div className="admin-header-wrapper">`
- í—¤ë” ì¹´ë“œ ë‚´ìš© (ë‹¨ì¼ í–‰): `<CardContent className="admin-header-card-content">`
- í—¤ë” ì¹´ë“œ ë‚´ìš© (í•„í„° í¬í•¨): `<CardContent className="admin-header-card-content flex-col items-start">`
- í•„í„° wrapper (ì¹´ë“œ ì™¸ë¶€): `<div className="admin-filter-wrapper">`
- í•„í„° wrapper (ì¹´ë“œ ë‚´ë¶€): `<div className="flex gap-2 items-center w-full mt-2">`
- í˜ì´ì§•: `<div className="admin-table-spacing">`

## EAV íŒ¨í„´ ë° ë°ì´í„° ê´€ë¦¬ ì „ëµ

### ê°œìš”

**Type/AttributeëŠ” ìŠ¤í‚¤ë§ˆ ì •ì˜ìš©, BusinessObject.data(JSON)ëŠ” ì‹¤ì œ ë°ì´í„° ì €ì¥ìš©**

### ì•„í‚¤í…ì²˜

#### 1. ë©”íƒ€ë°ì´í„° ê³„ì¸µ (ìŠ¤í‚¤ë§ˆ ì •ì˜)
- **Type**: ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´ íƒ€ì… ì •ì˜ (ì˜ˆ: Invoice, Contract)
- **Attribute**: ê³µí†µ ì†ì„± ì •ì˜ (ì˜ˆ: invoiceNumber, customerName)
- **TypeAttribute**: Typeê³¼ Attributeì˜ ì—°ê²° (Many-to-Many)

#### 2. ë°ì´í„° ê³„ì¸µ (ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤)
- **BusinessObject**: ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤
  - `typeId`: ì–´ë–¤ Typeì¸ì§€ ì°¸ì¡° (ìŠ¤í‚¤ë§ˆ ì •ì˜)
  - `data`: ì‹¤ì œ ì†ì„± ê°’ì„ JSONìœ¼ë¡œ ì €ì¥ (PostgreSQL JSONB)
  - âŒ **BusinessAttribute í…Œì´ë¸” ì œê±°ë¨** (EAV ë°©ì‹ ëŒ€ì‹  JSON ì‚¬ìš©)

### JSON ë°©ì‹ì˜ ì¥ì 

| í•­ëª© | EAV (BusinessAttribute) | JSON (data í•„ë“œ) |
|------|-------------------------|------------------|
| êµ¬ì¡° | ë³µì¡ (JOIN í•„ìš”) | âœ… ê°„ë‹¨ (1í–‰) |
| ì„±ëŠ¥ | ëŠë¦¼ (Nê°œ í–‰) | âœ… ë¹ ë¦„ |
| ì¿¼ë¦¬ | ì–´ë ¤ì›€ | âœ… JSONB í•¨ìˆ˜ í™œìš© |
| ìŠ¤í‚¤ë§ˆ ê²€ì¦ | Type/Attribute | âœ… ë™ì¼í•˜ê²Œ ì§€ì› |

### ì‚¬ìš© ì˜ˆì‹œ

```typescript
// 1. Type/Attribute ì •ì˜ (ìŠ¤í‚¤ë§ˆ)
const invoiceType = await prisma.type.create({
  data: { name: 'Invoice', description: 'ì†¡ì¥ ë¬¸ì„œ íƒ€ì…' },
})

const attr = await prisma.attribute.create({
  data: {
    key: 'invoiceNumber',
    label: 'ì†¡ì¥ ë²ˆí˜¸',
    description: 'ê³ ìœ  ì†¡ì¥ ì‹ë³„ ë²ˆí˜¸',
    attrType: 'STRING',
    isRequired: true,
  },
})

await prisma.typeAttribute.create({
  data: { typeId: invoiceType.id, attributeId: attr.id },
})

// 2. BusinessObject ìƒì„± (data í•„ë“œì— JSON)
const invoice = await prisma.businessObject.create({
  data: {
    typeId: invoiceType.id,
    policyId: 'policy1',
    currentState: 'Draft',
    description: '2024ë…„ 11ì›” ì†¡ì¥',
    data: {
      invoiceNumber: 'INV-2024-001',
      customerName: 'ABC ì£¼ì‹íšŒì‚¬',
      totalAmount: 5000000,
      isPaid: false,
    },
  },
})

// 3. ì¡°íšŒ ë° ê²€ì¦
const obj = await prisma.businessObject.findUnique({
  where: { id: invoice.id },
  include: {
    type: {
      include: {
        typeAttributes: {
          include: { attribute: true },
        },
      },
    },
  },
})

// ìŠ¤í‚¤ë§ˆ ì •ì˜ í™•ì¸
obj.type.typeAttributes.forEach((ta) => {
  console.log(`${ta.attribute.label}: ${ta.attribute.attrType}`)
})

// ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
const data = obj.data as Record<string, any>
console.log(data.invoiceNumber)  // 'INV-2024-001'
```

### PostgreSQL JSONB ì¿¼ë¦¬ ì˜ˆì‹œ

```sql
-- íŠ¹ì • ì†ì„± ê°’ìœ¼ë¡œ ê²€ìƒ‰
SELECT * FROM "BusinessObject" 
WHERE data->>'invoiceNumber' = 'INV-2024-001';

-- ìˆ«ì ë²”ìœ„ ê²€ìƒ‰
SELECT * FROM "BusinessObject" 
WHERE (data->>'totalAmount')::int > 1000000;

-- JSONB ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_business_object_data ON "BusinessObject" USING GIN (data);
```

---

## BusinessObject ë¦¬ë¹„ì „ ìë™ í• ë‹¹ ì‹œìŠ¤í…œ

### ê°œìš”

BusinessObjectì˜ ë¦¬ë¹„ì „ì„ Policy ê¸°ë°˜ìœ¼ë¡œ ìë™ í• ë‹¹í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**í•µì‹¬ ê°œë…:**
- **Policy**: `revisionSequence` í•„ë“œë¡œ ë¦¬ë¹„ì „ ìˆœì„œ ì •ì˜ (ì˜ˆ: "A,B,C")
- **Type**: ê³„ì¸µ êµ¬ì¡° ì§€ì›, ì†ì„± ìƒì† (`prefix`, `name`)
- **BusinessObject**: `typeId + policyId + name + revision` ì¡°í•©ìœ¼ë¡œ ìë™ ê´€ë¦¬

### ë°ì´í„° ëª¨ë¸

#### Policy

```prisma
model Policy {
  id               String   @id @default(cuid())
  name             String
  version          Int      @default(1)
  revisionSequence String   @default("A,B,C")  // ë¦¬ë¹„ì „ ìˆœì„œ
  
  types    Type[]
  businessObjects  BusinessObject[]
}
```

#### Type

```prisma
model Type {
  id       String   @id @default(cuid())
  type     String   @unique           // ê³ ìœ  íƒ€ì… (ì˜ˆ: "invoice")
  name     String?                    // ì‚¬ìš©ì ì¹œí™”ì  ì´ë¦„ (ìƒì† ê°€ëŠ¥)
  prefix   String?                    // ì ‘ë‘ì‚¬ (ì˜ˆ: "INV", ìƒì† ê°€ëŠ¥)
  
  policyId String
  policy   Policy   @relation(fields: [policyId], references: [id])
  
  // ê³„ì¸µ êµ¬ì¡°
  parentId String?
  parent   Type? @relation("TypeHierarchy", fields: [parentId], references: [id])
  children Type[] @relation("TypeHierarchy")
  
  objects  BusinessObject[] @relation("TypeObjects")
}
```

#### BusinessObject

```prisma
model BusinessObject {
  id             String   @id @default(cuid())
  typeId String?
  name           String?           // "ì†¡ì¥-2025-001"
  revision       String?           // "A", "B", "C"
  policyId       String
  
  type Type? @relation("TypeObjects", fields: [typeId], references: [id])
  policy       Policy        @relation(fields: [policyId], references: [id])
  
  @@unique([typeId, name, revision])           // ì´ë¦„ + ë¦¬ë¹„ì „ ìœ ë‹ˆí¬
}
```

### ìë™ í• ë‹¹ ë¡œì§

**Prisma Middleware** (`src/lib/prisma/middleware.ts`):

1. **policyId ìë™ í• ë‹¹**: Typeì˜ policyId ì‚¬ìš©
2. **name ìë™ ìƒì„±**: `prefix-timestamp-random` (ì˜ˆ: `INV-20251102-042`)
3. **revision ìˆœí™˜**: Policyì˜ `revisionSequence`ì— ë”°ë¼ A â†’ B â†’ C â†’ A...

```typescript
// ì‚¬ìš© ì˜ˆì‹œ
const obj = await prisma.businessObject.create({
  data: {
    typeId: 'type1',
    name: 'ì†¡ì¥-001',  // ë˜ëŠ” ìƒëµ ì‹œ ìë™ ìƒì„±
    currentState: 'draft',
  },
})
// ìë™ í• ë‹¹: { policyId: 'p1', revision: 'A' }
```

### ì†ì„± ìƒì†

**ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜** (`src/lib/business-type-utils.ts`):

```typescript
import { getInheritedTypeAttributes } from '@/lib/business-type-utils'

const attrs = await getInheritedTypeAttributes(typeId)
// ê²°ê³¼: { prefix: 'INV', name: 'ì¼ë°˜ ì†¡ì¥' }
// prefix/nameì´ ì—†ìœ¼ë©´ ë¶€ëª¨ë¡œë¶€í„° ì¬ê·€ì ìœ¼ë¡œ ìƒì†
```

### ê³„ì¸µ êµ¬ì¡°

```
Type (type: "document", prefix: "DOC")
â””â”€â”€ Type (type: "invoice", prefix: "INV")
    â””â”€â”€ Type (type: "tax-invoice", prefix: null)  // ë¶€ëª¨ë¡œë¶€í„° "INV" ìƒì†
```

### ë§ˆì´ê·¸ë ˆì´ì…˜

**íŒŒì¼**: `prisma/migrations/add_business_type_revision.sql`

```bash
# Supabase SQL Editorì—ì„œ ì‹¤í–‰
psql $DATABASE_URL -f prisma/migrations/add_business_type_revision.sql

# Prisma Client ì¬ìƒì„±
npx prisma generate
```

### ì£¼ì˜ì‚¬í•­

1. **ìœ ë‹ˆí¬ ì œì•½**: ë™ì¼ `typeId + name + revision` ì¡°í•©ì€ ì¤‘ë³µ ìƒì„± ë¶ˆê°€ (ë™ì¼ nameìœ¼ë¡œ ì—¬ëŸ¬ revisionì€ ê°€ëŠ¥)
2. **revision ìˆœí™˜**: Policyì˜ `revisionSequence` ë³€ê²½ ì‹œ ê¸°ì¡´ ë°ì´í„° ê²€ì¦ í•„ìš”
3. **ì†ì„± ìƒì†**: `prefix`, `name`ì´ ì—†ìœ¼ë©´ ë¶€ëª¨ Typeì—ì„œ ì¡°íšŒ

### ì„±ëŠ¥ ìµœì í™”

```prisma
@@index([typeId, policyId, name, revision])  // ë³µí•© ì¸ë±ìŠ¤
```

ìµœì‹  revision ì¡°íšŒ ì‹œ ë¹ ë¥¸ ì„±ëŠ¥ ë³´ì¥.

### ê´€ë ¨ ë¬¸ì„œ

- `BUSINESS_OBJECT_REVISION.md`: ìƒì„¸ ì„¤ëª… ë° ì‚¬ìš© ì˜ˆì‹œ
- `prisma/schema.prisma`: ì „ì²´ ìŠ¤í‚¤ë§ˆ ì •ì˜
- `src/lib/prisma/middleware.ts`: ìë™ í• ë‹¹ ë¡œì§
- `src/lib/business-type-utils.ts`: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

---

## ë‹¤í¬ëª¨ë“œ ë° í…Œë§ˆ

- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: next-themes
- **ì„¤ì •**: 
  - `<ThemeProvider attribute="class" defaultTheme="system" enableSystem>`
  - `suppressHydrationWarning` on `<html>` tag
- **í† ê¸€**: AdminLayout ìƒë‹¨ í—¤ë” (Moon/Sun ì•„ì´ì½˜)
- **ìƒ‰ìƒ**: Tailwind CSS ë³€ìˆ˜ ê¸°ë°˜ (`hsl(var(--primary))`)

## Design Template í˜ì´ì§€

- **ê²½ë¡œ**: `/admin/design-template`
- **ìœ„ì¹˜**: Help ë©”ë‰´ â†’ Design Template í•˜ìœ„ ë©”ë‰´
- **ëª©ì **: ëª¨ë“  UI ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- **ë ˆì´ì•„ì›ƒ**: `admin-page-container` + `admin-list-wrapper` ì‚¬ìš©, ìŠ¤í¬ë¡¤ ê°€ëŠ¥
- **íƒ­ êµ¬ì„±**:
  1. **Buttons** - ëª¨ë“  variants, sizes, states
  2. **Inputs** - Input (text, email, password, number, file), Textarea, Select, Checkbox, Radio Group, Date Picker, Calendar
  3. **Badges** - Badge variants, Alert variants
  4. **Tables** - BusinessObject ìŠ¤íƒ€ì¼ í…Œì´ë¸” (ScrollableTable)
  5. **Menus** - DropdownMenu, Pagination
  6. **Dialogs** - Drawer, Color Palette, Typography
  7. **Advanced** - Accordion, Tooltip, Toggle, Toggle Group, Switch, Progress, Slider, Separator, Skeleton
- **ì£¼ì˜ì‚¬í•­**: Calendar/Toggle-Group ì»´í¬ë„ŒíŠ¸ì˜ CSS ë³€ìˆ˜ êµ¬ë¬¸ (`--spacing(var(--gap))`, `size-(--cell-size)`) ì‚¬ìš© ê¸ˆì§€, í‘œì¤€ Tailwind í´ë˜ìŠ¤ ì‚¬ìš© (ì˜ˆ: `gap-1`, `size-9`)

## ë¬¸ì„œ êµ¬ì¡°

### user_scenario/ (ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë° í…ŒìŠ¤íŠ¸)
- **USER_SCENARIO_TEST.md**: 7ê°œ ì‹œë‚˜ë¦¬ì˜¤, 20ê°œ ë‹¨ê³„, 42ê°œ ìŠ¤í¬ë¦°ìƒ·
- **TEST_CHECKLIST.md**: 113ê°œ í…ŒìŠ¤íŠ¸ í•­ëª©
- **TEST_REPORT.md**: ìë™í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼ (100% í†µê³¼) â­
- **UI_COMPONENTS.md**: UI ì»´í¬ë„ŒíŠ¸ ë ˆí¼ëŸ°ìŠ¤
- **screenshots/**: í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦°ìƒ· í´ë”
- **ì—…ë°ì´íŠ¸**: ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜ì • ìš”ì²­ ì‹œ ë¬¸ì„œ ìë™ ì—…ë°ì´íŠ¸

### docs/ (ê¸°ìˆ  ë¬¸ì„œ)
- **database/DATABASE_MODEL_GUIDE.md**: í†µí•© ë°ì´í„°ë² ì´ìŠ¤ ê°€ì´ë“œ â­
- **api/**: API ê°€ì´ë“œ
- **testing/**: í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ (13ê°œ)
- **auth/**: ì¸ì¦ ê°€ì´ë“œ (2ê°œ)
- **ui/**: UI/UX ê°€ì´ë“œ (8ê°œ)
- **setup/**: í™˜ê²½ ì„¤ì • (4ê°œ)
- **archive/**: ì•„ì¹´ì´ë¸Œ (4ê°œ)

## Policy ì‚­ì œ ì œì•½

- **onDelete**: `Restrict` (Cascadeì—ì„œ ë³€ê²½)
- **ì¢…ì† ë°ì´í„° í™•ì¸**:
  - State ì¡´ì¬ ì‹œ â†’ ì‚­ì œ í•„ìš”
  - Type ì¡´ì¬ ì‹œ â†’ ì‚­ì œ ë˜ëŠ” ë‹¤ë¥¸ Policyë¡œ ë³€ê²½
  - BusinessObject ì¡´ì¬ ì‹œ â†’ ì‚­ì œ ë˜ëŠ” Type ë³€ê²½
- **ì‚­ì œ ë²„íŠ¼**: ì¢…ì† ë°ì´í„° ìˆìœ¼ë©´ ë¹„í™œì„±í™”

## ì°¸ê³ ì‚¬í•­

- Supabase ì½˜ì†”ì—ì„œ OAuth Redirect URLs ì„¤ì • í•„ìˆ˜
- í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ `NEXT_PUBLIC_SITE_URL` ì‹¤ì œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½
- RLS ì •ì±… ë•Œë¬¸ì— ë³¸ì¸ ë°ì´í„°ë§Œ ì¡°íšŒë¨ (ê´€ë¦¬ì ê¶Œí•œ í•„ìš” ì‹œ ë³„ë„ ì •ì±… ì¶”ê°€)
- Prisma ì‚¬ìš© ì‹œ `.env.local`ì— `DATABASE_URL` ì„¤ì • í•„ìš”

