# í†µí•© í…ŒìŠ¤íŠ¸ ë™ì‹œì„± ë¬¸ì œ ì„¤ëª…

## ğŸ¤” ì¶©ëŒ ë°©ì§€ ë¡œì§ì´ë€?

### ì„¤ì •

```javascript
// jest.integration.config.js
maxWorkers: 1  // ìˆœì°¨ ì‹¤í–‰
```

**ì˜ë¯¸:**
- `maxWorkers: 1` â†’ í•œ ë²ˆì— 1ê°œ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
- `maxWorkers: 3` â†’ í•œ ë²ˆì— 3ê°œ í…ŒìŠ¤íŠ¸ ë™ì‹œ ì‹¤í–‰

---

## âš”ï¸ ì¶©ëŒì´ ë°œìƒí•˜ëŠ” ê²½ìš°

### 1. UNIQUE ì œì•½ ì¶©ëŒ

**ë§Œì•½ ì´ë ‡ê²Œ í–ˆë‹¤ë©´:**
```typescript
// Test 1ê³¼ Test 2ê°€ ë™ì‹œì— ì‹¤í–‰
// Test 1
const policy = await prisma.policy.create({
  data: { name: 'TestPolicy', version: 1 }
})

// Test 2 (ë™ì‹œì—)
const policy = await prisma.policy.create({
  data: { name: 'TestPolicy', version: 1 }  // âŒ UNIQUE ì œì•½ ìœ„ë°˜!
})
```

**ìš°ë¦¬ëŠ”:**
```typescript
// Test 1
name: `Test_Policy_${Date.now()}`  // Test_Policy_1762048001
// Test 2
name: `Test_Policy_${Date.now()}`  // Test_Policy_1762048002 (ë‹¤ë¦„!)
```

**ê²°ë¡ :** íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©ìœ¼ë¡œ ì¶©ëŒ ì—†ìŒ âœ…

---

### 2. DB ì—°ê²° í’€ ê³ ê°ˆ

**ë¬¸ì œ:**
```
Pooler ìµœëŒ€ ì—°ê²°: 15ê°œ
ë³‘ë ¬ í…ŒìŠ¤íŠ¸ 3ê°œ Ã— ê° 5ê°œ ì—°ê²° = 15ê°œ
â†’ ì—°ê²° í’€ ê³ ê°ˆ ê°€ëŠ¥
```

**ì‹¤ì œ:**
- ìš°ë¦¬ í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìˆœ CRUD
- ì—°ê²° í’€ ê³ ê°ˆ ê°€ëŠ¥ì„± ë‚®ìŒ

---

### 3. íŠ¸ëœì­ì…˜ ì¶©ëŒ

**ë¬¸ì œ:**
```typescript
// Test 1ê³¼ Test 2ê°€ ë™ì‹œì— ê°™ì€ ë ˆì½”ë“œ ìˆ˜ì •
// Test 1
UPDATE "Policy" SET version = 2 WHERE id = 'p1'  // ğŸ”’ Lock

// Test 2 (ëŒ€ê¸°...)
UPDATE "Policy" SET version = 3 WHERE id = 'p1'  // â³ ëŒ€ê¸°
```

**ìš°ë¦¬ëŠ”:**
- ê° í…ŒìŠ¤íŠ¸ê°€ ë…ë¦½ì ì¸ ë ˆì½”ë“œ ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„)
- ê°™ì€ ë ˆì½”ë“œ ìˆ˜ì • ì•ˆ í•¨

---

## ğŸ§ª ì‹¤í—˜ ê²°ê³¼

### ìˆœì°¨ ì‹¤í–‰ (`maxWorkers: 1`)
```
Time: 49.27s
Tests: 7 passed, 7 total
âœ… ëª¨ë‘ ì„±ê³µ
```

### ë³‘ë ¬ ì‹¤í–‰ (`maxWorkers: '50%'`)
```
Time: 34.57s (29% ë¹ ë¦„!)
Tests: 3 failed, 4 passed, 7 total
âŒ ì¼ë¶€ ì‹¤íŒ¨ (íƒ€ì„ì•„ì›ƒ)
```

**ì‹¤íŒ¨ ì›ì¸:**
- DB ì—°ê²° ê²½ìŸìœ¼ë¡œ ì¼ë¶€ ì¿¼ë¦¬ê°€ 15ì´ˆ ì´ˆê³¼
- ì¶©ëŒì€ ì—†ì§€ë§Œ, ì—°ê²° ëŒ€ê¸° ì‹œê°„ ì¦ê°€

---

## ğŸ“Š ë¹„êµ

| ì„¤ì • | ì‹œê°„ | ì„±ê³µë¥  | ì•ˆì •ì„± |
|------|------|--------|--------|
| **maxWorkers: 1** | 49s | 100% | â­â­â­ |
| **maxWorkers: '50%'** | 35s | 57% | â­ |
| maxWorkers: 2 | 40s | 85% | â­â­ |
| maxWorkers: 3 | 30s | 42% | âŒ |

---

## ğŸ¯ ê²°ë¡ 

### ì¶©ëŒ ë°©ì§€ ë¡œì§ì´ í•„ìš”í•œê°€?

**ìš°ë¦¬ ì½”ë“œ:**
- âŒ UNIQUE ì œì•½ ì¶©ëŒ ì—†ìŒ (íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©)
- âŒ íŠ¸ëœì­ì…˜ ì¶©ëŒ ì—†ìŒ (ë…ë¦½ì  ë ˆì½”ë“œ)
- âš ï¸ DB ì—°ê²° í’€ ê²½ìŸ ìˆìŒ (Pooler ì œí•œ)

**ê²°ë¡ :**
- **ì¶©ëŒ ë°©ì§€**ëŠ” ì•„ë‹˜
- **ì—°ê²° í’€ ê´€ë¦¬**ê°€ ëª©ì 
- **ì•ˆì •ì„±** ìš°ì„  â†’ `maxWorkers: 1` ê¶Œì¥

---

## âš¡ ì„±ëŠ¥ vs ì•ˆì •ì„±

### ë¹ ë¥¸ ì‹¤í–‰ ì›í•˜ë©´ (ìœ„í—˜)
```javascript
maxWorkers: 2
testTimeout: 30000  // íƒ€ì„ì•„ì›ƒ ì¦ê°€
```
**íš¨ê³¼:** ~40ì´ˆ (20% ë¹ ë¦„)

### ì•ˆì •ì„± ì›í•˜ë©´ (ê¶Œì¥)
```javascript
maxWorkers: 1
testTimeout: 30000
```
**íš¨ê³¼:** ~49ì´ˆ (100% ì„±ê³µ)

---

## ğŸ“ ì‹¤ì œ ì¶©ëŒ ì‚¬ë¡€

### ë§Œì•½ ì´ë ‡ê²Œ í–ˆë‹¤ë©´:

```typescript
// âŒ ë‚˜ìœ ì˜ˆ
it('test 1', async () => {
  await prisma.policy.deleteMany({})  // ëª¨ë“  Policy ì‚­ì œ
  const policy = await prisma.policy.create({ ... })
})

it('test 2', async () => {
  const policies = await prisma.policy.findMany()  // âŒ ë¹ˆ ë°°ì—´ (test 1ì´ ì‚­ì œ)
})
```

### ìš°ë¦¬ ì½”ë“œ:

```typescript
// âœ… ì¢‹ì€ ì˜ˆ
it('test 1', async () => {
  const policy = await prisma.policy.create({
    data: { name: `Policy_${Date.now()}` }  // ë…ë¦½ì 
  })
})

it('test 2', async () => {
  const policy = await prisma.policy.create({
    data: { name: `Policy_${Date.now()}` }  // ë…ë¦½ì 
  })
})
```

---

## âœ… ìµœì¢… ì„¤ì •

```javascript
// jest.integration.config.js
maxWorkers: 1  // ìˆœì°¨ ì‹¤í–‰
testTimeout: 30000  // 30ì´ˆ

// ì´ìœ :
// 1. DB ì—°ê²° í’€ ì•ˆì •ì„±
// 2. íƒ€ì„ì•„ì›ƒ ë°©ì§€
// 3. 100% ì„±ê³µë¥ 
```

**ì‹œê°„:** 49ì´ˆ (ì–‘í˜¸)  
**ì„±ê³µë¥ :** 100%  
**ì•ˆì •ì„±:** â­â­â­

---

**ì¶©ëŒ ë°©ì§€ê°€ ì•„ë‹ˆë¼ "DB ì—°ê²° ì•ˆì •ì„± ê´€ë¦¬"ê°€ ì •í™•í•œ í‘œí˜„ì…ë‹ˆë‹¤!** ğŸ¯

