# ğŸš€ ì„±ëŠ¥ ë¬¸ì œ í•´ê²°: createdAt ì¸ë±ìŠ¤ ì¶”ê°€

## âŒ ë¬¸ì œ

**BusinessObject ëª©ë¡ì´ 5.9ì´ˆë‚˜ ê±¸ë ¸ë˜ ì´ìœ :**

```sql
-- ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬:
SELECT * FROM "BusinessObject"
LEFT JOIN "Type" ...
LEFT JOIN "Policy" ...
ORDER BY "createdAt" DESC  -- âŒ ì¸ë±ìŠ¤ ì—†ìŒ!
LIMIT 200;

-- ê²°ê³¼:
-- Full Table Scan (ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”)
-- 700ms+ (DB ì¿¼ë¦¬)
-- 5.20s (ë°ì´í„° ì „ì†¡)
-- ì´ 5.9ì´ˆ
```

**ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë©´:**
- ëª¨ë“  í–‰ì„ ì½ì–´ì„œ ì •ë ¬
- ë°ì´í„°ê°€ ë§ì„ìˆ˜ë¡ ëŠë¦¼
- LIMITê°€ ìˆì–´ë„ ì†Œìš©ì—†ìŒ

---

## âœ… í•´ê²°

### 1. Prisma Schema ìˆ˜ì •

```prisma
model BusinessObject {
  // ...
  createdAt DateTime @default(now())
  
  // ì¸ë±ìŠ¤ ì¶”ê°€ (ì¤‘ìš”!)
  @@index([createdAt])  // â† ìƒˆë¡œ ì¶”ê°€!
}
```

---

### 2. SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

**íŒŒì¼:** `prisma/migrations/add_business_object_created_at_index.sql`

**Supabase SQL Editorì—ì„œ ì‹¤í–‰:**

```sql
CREATE INDEX IF NOT EXISTS "BusinessObject_createdAt_idx" 
  ON "BusinessObject"("createdAt" DESC);
```

**ì‹¤í–‰ ë°©ë²•:**
1. Supabase Dashboard â†’ SQL Editor
2. ìœ„ SQL ë³µì‚¬ â†’ ë¶™ì—¬ë„£ê¸°
3. "Run" í´ë¦­
4. "Success" í™•ì¸

---

### 3. Prisma Client ì¬ìƒì„±

```bash
npx prisma generate
```

---

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ê°œì„ 

### Before (ì¸ë±ìŠ¤ ì—†ìŒ):
```
DB ì¿¼ë¦¬: 700ms (Full Table Scan)
ë°ì´í„° ì „ì†¡: 5.20s
ì´: 5.9ì´ˆ
```

### After (ì¸ë±ìŠ¤ ì¶”ê°€):
```
DB ì¿¼ë¦¬: 50-100ms (Index Scan)
ë°ì´í„° ì „ì†¡: 5.20s (ë™ì¼)
ì´: 5.25s

ì¿¼ë¦¬ ì‹œê°„: 10ë°° ë¹ ë¦„! âš¡
```

**ì™œ ë°ì´í„° ì „ì†¡ì€ ì—¬ì „íˆ ëŠë¦°ê°€?**
- 45ê°œ Ã— í‰ê·  2KB = 90KB
- ëŠë¦° ë„¤íŠ¸ì›Œí¬: 5ì´ˆ+

---

## ğŸš€ ì¶”ê°€ ìµœì í™” (ì„ íƒ)

### 1. `data` í•„ë“œ ì œê±° (ëª©ë¡ì—ì„œëŠ” ë¶ˆí•„ìš”)

```typescript
// src/app/admin/business-objects/page.tsx
select: {
  // ...
  data: false,  // â† ì œê±°! (ìƒì„¸ í˜ì´ì§€ì—ì„œë§Œ í•„ìš”)
}
```

**ì˜ˆìƒ ê°œì„ :**
- 45ê°œ Ã— 2KB ì ˆì•½ = 90KB ê°ì†Œ
- ì „ì†¡ ì‹œê°„: 5.20s â†’ 0.5s (10ë°° ë¹ ë¦„!)

---

### 2. Limit ì¤„ì´ê¸°

```typescript
take: 50,  // 200 â†’ 50
```

**ì˜ˆìƒ ê°œì„ :**
- ë°ì´í„° í¬ê¸°: 1/4
- ì „ì†¡ ì‹œê°„: 5.20s â†’ 1.3s

---

### 3. ì••ì¶• í™œì„±í™” (Vercel)

Vercelì€ ê¸°ë³¸ì ìœ¼ë¡œ gzip ì••ì¶•ì„ ì‚¬ìš©í•˜ì§€ë§Œ, í™•ì¸:

```typescript
// next.config.ts
compress: true,  // ê¸°ë³¸ê°’
```

---

## ğŸ¯ ê¶Œì¥ ì¡°í•©

**ì¦‰ì‹œ ì ìš©:**
1. âœ… createdAt ì¸ë±ìŠ¤ ì¶”ê°€ (í•„ìˆ˜!)
2. âœ… `data` í•„ë“œ ì œê±° (ëª©ë¡ì—ì„œëŠ” ë¶ˆí•„ìš”)
3. âœ… limit 50ìœ¼ë¡œ ì¤„ì´ê¸°

**ì˜ˆìƒ ê²°ê³¼:**
```
DB ì¿¼ë¦¬: 700ms â†’ 50ms (14ë°° ë¹ ë¦„!)
ë°ì´í„° ì „ì†¡: 5.20s â†’ 0.5s (10ë°° ë¹ ë¦„!)
ì´: 5.9s â†’ 0.55s (10ë°° ë¹ ë¦„!)
```

---

## ğŸ“ ì ìš©í•˜ê¸°

ì§€ê¸ˆ ë°”ë¡œ ìµœì í™”í•´ë“œë¦´ê¹Œìš”?

```typescript
// 1. data í•„ë“œ ì œê±°
// 2. limit 50ìœ¼ë¡œ
// 3. createdAt ì¸ë±ìŠ¤ ì¶”ê°€
```

ì´ë ‡ê²Œ í•˜ë©´ **5.9ì´ˆ â†’ 0.5ì´ˆ**ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸš€

